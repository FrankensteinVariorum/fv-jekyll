{"version":3,"sources":["assets/pre.jpg","assets/next.jpg","images/intensity_legend.svg","data/xml-cache.ts","tei-processing/helpers.ts","data/edition.ts","data/spine.ts","data/store.ts","components/helpers/EditionDot.tsx","components/PageLayout/EditionSelector.tsx","components/tei/TeiReactElement.tsx","components/tei/TeiReactText.tsx","components/tei/TeiAppWrapper.tsx","tei-processing/tei-converter.ts","components/tei/TeiContainer.tsx","components/PageLayout/Paging.tsx","components/PageLayout/Header.tsx","components/PageLayout/OptionsSelector.tsx","components/Variations/ReadingGroupComponent.tsx","components/Variations/Variation.tsx","components/Viewer/Viewer.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","__webpack_require__","p","XmlCache","Object","classCallCheck","this","_xmls","_promises","Map","url","_this","has","Promise","resolve","get","promise","fetchXML","set","then","delete","xml","DOMParser","parseFromString","fetch","response","text","doc","parseXML","evaluateXPath","xpath","resolver","createNSResolver","documentElement","evaluate","err","console","error","concat","xpathResult","nodes","node","iterateNext","push","findElementByXmlId","xmlId","attrName","startsWith","idResults","length","Error","documentCount","Edition","code","name","chunks","createClass","key","value","chunkId","chunkStr","_getXML","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","next","FvStore","cache","getXML","getChunkUrl","abrupt","sent","stop","_x","apply","arguments","document","EditionWithBody","_Edition","possibleConstructorReturn","getPrototypeOf","inherits","getElementsByTagName","MSEdition","_Edition2","map","n","Chunk","edition","chunkNumber","tei","spine","mainRoots","marginRoots","variations","getMainRootElements","getMarginRootElements","appRef","app","apps","find","id","_load","_callee2","chunk","_context2","getSpine","initialize","_x2","_x3","ReadingGroup","apparatus","groupId","editions","element","pointers","fillEditions","fillPointers","buildElement","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","ptr","indexOf","return","filter","implementation","createDocument","group","createElement","children","dereferenced","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","clone","cloneNode","appendChild","Apparatus","_groups","idAttr","attributes","getNamedItem","nAttr","parseInt","parsePointers","_this2","groupSet","Set","Array","from","grp","_this3","el","parsePointer","ptrElement","rdgElement","parentNode","tagName","witAttr","editionCode","substr","getEdition","rdgGroupElement","grpIdAttr","targetAttr","parts","split","referencedUrl","referencedTarget","ed","groups","Spine","_apps","_xml","_initialized","_initializationPromise","_this4","innerInitialize","_innerInitialize","parseApps","fetchAllReferences","rewriteStringRanges","dereferencePointers","addBackPointers","buildGroupsInApps","_parseApps","_callee3","appElements","_context3","_fetchAllReferences","_callee4","allUrls","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","urls","unique","promises","_context4","t0","finish","all","_rewriteStringRanges","_callee5","re","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_loop","_iterator4","_step4","_this5","_context6","_wrapRegExp","start","invalidPointers","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","match","stringRange","validPointers","_context5","rewriteStringRange","add","t1","delegateYield","_rewriteStringRange","_callee6","range","targetDoc","targetNodes","targetElement","_context7","mockElementCount","setAttribute","_dereferencePointers","_callee7","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_loop2","_iterator6","_step6","_context9","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_iterator7","_step7","_document","_context8","outerHTML","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","buildGroups","FvStoreClass","spines","i","sp","instance","EditionDot","classes","props","react_default","className","React","Component","EditionSelector","state","availableEditions","selectedEdition","componentDidMount","index","label","helpers_EditionDot","setState","editionChanged","selectedOption","onEditionSelected","warn","prevProps","option","react_select_browser_esm","onChange","options","TeiReactElement","tag","closingTag","htmlTag","data-tei-tag","ReactHtmlParser","TeiReactText","showText","TeiAppWrapper","onClick","showVariations","onAppClick","intensity","getOtherGroups","dotElements","groupDots","dotClasses","TeiConverter","teiTag","nodeAttributes","valueProps","nodeName","nodeValue","reactChildren","hasChildNodes","childNodes","childNode","childElement","nodeType","teiToReactElement","textContent","trim","teiProps","buildProperties","getHtmlTag","reactElement","getApp","TeiRendering","elements","getTeiObjects","converter","root","Paging","chunkIndex","availableChunks","disablePrev","disableNext","onChunkChanged","findIndex","opt","toString","onChunkSelected","updateChunk","delta","newChunk","newOption","c","firstChunk","disabled","src","pre","alt","Header","e","OptionsSelector","onVariationChanged","newShow","onTextChanged","newShowText","type","checked","ReadingGroupComponent","title","join","dots","content","Variation","Variations_ReadingGroupComponent","Viewer","loading","onNewChunk","load","onNewEdition","onVariation","show","onText","PageLayout_EditionSelector","PageLayout_Paging","PageLayout_OptionsSelector","PageLayout_Header","TeiContainer","Variations_Variation","App","components_Viewer_Viewer","Boolean","window","location","hostname","ReactDOM","render","src_App_0","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.be5c392e.chunk.js","sourcesContent":["module.exports = \"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAwCAYAAAC4wJK5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGuSURBVGhD7ZjPqwFRGIbv/07SxEZSLCwUCws1KRYWaiwsLCwoiaKYsrCgKAt6b+fm3G7u5/IxZ+Y7t3nqKdnM+5QfZ+YD/4A4QgpxhBTiCCnEEVIQG7Fer6+vHiMuYjKZoFgsYj6fX995jJiIzWaDer2ORCLxpVURp9MJnU7ne7x1EYPBAJlM5leAFRGz2QzlcpkcrxUbsd1u0Wg0yNG3iou4XC7odrvk2HuKihgOh8jlcuTQvxQRsVwuUalUyIHPGGnEfr9Hs9kkh3GMLKLX6yGVSpGjuIYeMR6PUSgUyDGvGlqE7/uo1WrkiHc1HnE8HtFut8mLB6XRiH6/D8dxyAsHqZGI6XSKUqlEXtCEgUeo40IQP5scjX2c3v0D42j8i/3qUYKj8QjF+XxmH+o4hhKh4RyvOYYaoXnmRodjJBEadcuZzWbJYRwjjVDcu/nnGHmE5vYxDEcxERr9QIwae09xERp17kqn0+ToW8VGKA6HA1qtFjn8p6IjNKvVCtVqlQxQWhGhGY1GyOfzdkdoPM9DMpm0O0Kx2+3guq7dEZrFYmF/BJc4QgpxhAyAT37H75LDLfRTAAAAAElFTkSuQmCC\"","module.exports = \"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAtCAYAAAA+7zKnAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGhSURBVGhD7Zixq4JAHMff/55IkINDg0NBg0OIi1AigYOBgkRLECEOEkENDUUOBQ2/h/G76T3eS7273wV+4Avq3f1+n0W88ws+mE6eik6eilryRVHglRrUkt/tdjAajSDLMnxCS235Xq/3iuu6cD6fcYSGxvIsYRjC8/nEGXJpLV/FNE1Yr9c4Sx5c5Fkmk4nUl5qrPIvneXC5XHCVOITIsyyXS1wpBqHyVYbDIWw2G6zAF+HyLLZtw+FwwEp8kCbP4vs+lGWJFdshXb5Kv9+HJEmwanNI5Fksy3rVbAqpPIvjOHA6nbDL+yghz7JYLODxeGC3/1FKvophGLBarbDj3ygnzzIejyHPc+z8O8rKV5nP53C9XrH7T5SUf/eDppR83a2EEvKapkEURdjlfcjl22yfyeR5HFyky/M8MkqV531YlyIv6jeJUHnRP6iEyA8GA0jTFFeJg7t8EARwv99xhVi4yU+nUzgejzhTDq3lq9PQdrvFGXJpLK/rOsRxjCM0NJKfzWZwu93wKR215ff7Pd7RU0teNTp5Kjp5Kj5YHuAbGi0/JXQ9+WUAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/intensity_legend.91d6f78c.svg\";","// This class holds a cache of XML documents, fetching them from the web if they are not there\r\n// Every piece of code uses this, so that we can load XMLs again and again without worried about performance\r\n//\r\n// NOTE: The cache contains parsed Documents. If you change the document, it's going to be changed everywhere.\r\n// This is on purpose - as we add attributes and tags for pointer resolution.\r\n\r\nexport default class XmlCache {\r\n    private  _xmls : Map<string, Document>;  // Map from URL to a parsed XML\r\n    private _promises: Map<string, Promise<Document>>;\r\n    private static documentCount = 0;\r\n\r\n    public constructor() {\r\n        this._xmls = new Map<string, Document>();\r\n        this._promises = new Map<string, Promise<Document>>();\r\n    }\r\n\r\n    public getXML(url: string): Promise<Document> {\r\n        // This function is async, but we implement the Promises ourselves, since we also cache promises\r\n        // This code only works because asynchronous Javascript is single threaded (note there are no locks)\r\n        if (this._xmls.has(url)) {\r\n            return Promise.resolve(this._xmls.get(url)!);\r\n        }\r\n\r\n        if (this._promises.has(url)) {\r\n            return this._promises.get(url)!;\r\n        }\r\n\r\n        const promise = this.fetchXML(url);\r\n        this._promises.set(url, promise);\r\n        promise.then(() => {\r\n            this._promises.delete(url);\r\n        });\r\n        return promise;\r\n    }\r\n\r\n    private parseXML(xml: string) {\r\n        const parser = new DOMParser();\r\n        const doc = parser.parseFromString(xml, \"text/xml\");\r\n    \r\n        return doc;\r\n    }\r\n    \r\n    private async fetchXML(url:string) {\r\n        const response = await fetch(url);\r\n        const xml = await response.text();\r\n    \r\n        const doc = this.parseXML(xml);\r\n        this._xmls.set(url, doc);\r\n\r\n        return doc\r\n    }\r\n}","\r\nexport function evaluateXPath(doc: Document, xpath: string): Node[] {\r\n    const resolver = doc.createNSResolver(doc.documentElement);\r\n    try{\r\n        doc.evaluate(xpath, doc, resolver);\r\n    } catch(err) {\r\n        console.error(`xpath evaluation of ${xpath} failed: `, err);\r\n    }\r\n    const xpathResult = doc.evaluate(xpath, doc, resolver);\r\n    const nodes: Node[] = [];\r\n\r\n    let node = xpathResult.iterateNext();\r\n    while(node) {\r\n        nodes.push(node);\r\n        node = xpathResult.iterateNext();\r\n    }\r\n\r\n    return nodes;\r\n}\r\n\r\nexport function findElementByXmlId(doc: Document, xmlId: string): Element {\r\n    const attrName = xmlId.startsWith('mock') ? 'mock-id' : 'xml:id';\r\n    const xpath = `//*[@${attrName}=\"${xmlId}\"]`;\r\n    const idResults = evaluateXPath(doc, xpath);\r\n\r\n    if (idResults.length === 0) {\r\n        throw Error(`Pointer ${xmlId} references an invalid element`);\r\n    } else if (idResults.length > 1) {\r\n        throw Error(`Pointer ${xmlId} references more than one element`);\r\n    }\r\n    return idResults[0] as Element;\r\n}\r\n","import FvStore from \"./store\";\r\nimport { Spine } from \"./spine\";\r\nimport { evaluateXPath } from \"../tei-processing/helpers\";\r\n\r\nexport abstract class Edition {\r\n    public readonly code: string = ''; // 1818, 1823, 1831, Thomas, MS\r\n    public readonly name: string = '';\r\n    public readonly chunks: number[] = [];\r\n\r\n    constructor(code: string, name: string, chunks: number[]) {\r\n        this.code = code;\r\n        this.name = name;\r\n        this.chunks = chunks;\r\n    }\r\n\r\n    protected getChunkUrl(chunkId: number) {\r\n        const chunkStr = chunkId < 10 ? `0${chunkId}` : `${chunkId}`;\r\n        const url = `https://raw.githubusercontent.com/PghFrankenstein/fv-data/master/variorum-chunks/f${this.code}_C${chunkStr}.xml`;\r\n\r\n        return url;\r\n    }\r\n\r\n    public async getXML(chunkId: number) {\r\n        return await FvStore.cache.getXML(this.getChunkUrl(chunkId));\r\n    }\r\n\r\n    public abstract getMainRootElements(document: Document): Element[];\r\n    public getMarginRootElements(document: Document): Element[] {\r\n        return []; // The default behavior is no margins\r\n    }\r\n}\r\n\r\nexport class EditionWithBody extends Edition {\r\n    public getMainRootElements(document: Document): Element[] {\r\n        try {\r\n            return [document.getElementsByTagName('body')[0]];\r\n        } catch(err) {\r\n            console.error(`Can't located body element of ${this.code}: ${err}`);\r\n            throw new Error(\"Can't locate body element\");\r\n        }\r\n    }\r\n} \r\n\r\nexport class MSEdition extends Edition { \r\n    public getMainRootElements(document: Document): Element[] {\r\n        const xpath = \"//tei:zone[@type='main']\";\r\n        const nodes = evaluateXPath(document, xpath);\r\n        return nodes.map((n) => n as Element);\r\n    }\r\n\r\n    public getMarginRootElements(document: Document): Element[] {\r\n        const xpath = \"//tei:zone[@type='left_margin']\";\r\n        const nodes = evaluateXPath(document, xpath);\r\n        return nodes.map((n) => n as Element);\r\n    }\r\n}\r\n\r\n\r\nexport class Chunk {\r\n    public readonly edition: Edition;\r\n    public readonly chunkNumber: number;\r\n    public readonly tei: Document;\r\n    public readonly mainRoots: Element[];\r\n    public readonly marginRoots: Element[];\r\n    public readonly variations: Spine;\r\n\r\n    private constructor(edition: Edition, chunkNumber: number, tei: Document, spine: Spine) {\r\n        this.edition = edition;\r\n        this.chunkNumber = chunkNumber;\r\n        this.tei = tei;\r\n        this.variations = spine;\r\n        this.mainRoots = edition.getMainRootElements(tei);\r\n        this.marginRoots = edition.getMarginRootElements(tei);\r\n    }\r\n\r\n    public static async load(edition: Edition, chunkNumber: number): Promise<Chunk> {\r\n        const document = await edition.getXML(chunkNumber);\r\n        const spine = await FvStore.getSpine(chunkNumber);\r\n        await spine.initialize();\r\n\r\n        const chunk = new Chunk(edition, chunkNumber, document, spine);\r\n        // chunk.addAppReferences();\r\n\r\n        return chunk;\r\n    }\r\n\r\n    public getApp(appRef: string) {\r\n        const app = this.variations.apps.find((a) => a.id === appRef);\r\n        if(!app) {\r\n            throw new Error(`Can't locate app ${appRef}`);\r\n        }\r\n        return app;\r\n    }\r\n}\r\n","import FvStore from \"./store\";\r\nimport { Edition } from \"./edition\";\r\nimport { evaluateXPath, findElementByXmlId } from \"../tei-processing/helpers\";\r\n\r\ninterface PointerData {\r\n    ptrElement: Element;\r\n    groupId: string;\r\n    edition: Edition;\r\n    referencedUrl: string;\r\n    referencedTarget: string;\r\n\r\n    dereferenced?: Element;\r\n}\r\n\r\n// async function debug1818(where: string) {\r\n//     const xml = await FvStore.getEdition('1818').getXML(1);\r\n//     console.debug(`1818 ${where}:`)\r\n//     console.debug(xml.documentElement.outerHTML);\r\n// }\r\n\r\nexport class ReadingGroup {\r\n    public readonly groupId: string;\r\n    public readonly editions: Edition[];\r\n    public readonly apparatus: Apparatus;\r\n    public readonly element: Element;\r\n\r\n    private readonly pointers: PointerData[];\r\n\r\n    constructor(apparatus: Apparatus, groupId: string) {\r\n        this.groupId = groupId;\r\n        this.apparatus = apparatus;\r\n        this.editions = this.fillEditions();\r\n        this.pointers = this.fillPointers();\r\n        this.element = this.buildElement();\r\n    }\r\n\r\n    private fillEditions() {\r\n        const editions = [] as Edition[];\r\n        for (const ptr of this.apparatus.pointers) {\r\n            if (ptr.groupId === this.groupId && editions.indexOf(ptr.edition) === -1) {\r\n                editions.push(ptr.edition);\r\n            }\r\n        }\r\n\r\n        return editions;\r\n    }\r\n\r\n    private fillPointers() {\r\n        // Fill pointers for one of the editions in the group, as they are all identical\r\n        const edition = this.editions[0];\r\n        return this.apparatus.pointers.filter((ptr) => ptr.groupId === this.groupId && ptr.edition === edition);\r\n    }\r\n\r\n    private buildElement() {\r\n        // Build a new XML element that contains all the dereferenced pointers in this group\r\n        // We create a new document for each such element\r\n        const doc = document.implementation.createDocument(null, null, null);\r\n        const group = doc.createElement('rdgGrp');\r\n        const children = this.pointers.map((ptr) => ptr.dereferenced!);\r\n        for(const child of children) {\r\n            const clone = child.cloneNode(true);  // We must clone the node, otherwise it's detached from the original XML\r\n            group.appendChild(clone);\r\n        }\r\n        doc.appendChild(group);\r\n\r\n        return group;\r\n    }\r\n}\r\n\r\nexport class Apparatus {  // Content of the <app> tag\r\n    public readonly id: string;\r\n    public readonly n: number | undefined;\r\n    public readonly element: Element;\r\n\r\n    public pointers: PointerData[];\r\n    private _groups: ReadingGroup[];\r\n\r\n    constructor(element: Element) {\r\n        this.element = element;\r\n\r\n        const idAttr = element.attributes.getNamedItem('xml:id')\r\n        if (!idAttr) {\r\n            throw new Error('<app> tag with no xml:id');\r\n        }\r\n        this.id = idAttr.value;\r\n\r\n        const nAttr = element.attributes.getNamedItem('n');\r\n        this.n = nAttr ? parseInt(nAttr.value) : undefined;\r\n\r\n        this.pointers = this.parsePointers();\r\n        this._groups = [];\r\n    }\r\n\r\n    public get groups() { return this._groups; }\r\n\r\n    public buildGroups() {\r\n        const groupSet = new Set<string>(this.pointers.map((ptr) => ptr.groupId));\r\n        this._groups = Array.from(groupSet).map((grp) => new ReadingGroup(this, grp));\r\n    }\r\n\r\n    private parsePointers() {\r\n        const ptrElements = Array.from(this.element.getElementsByTagName('ptr'));\r\n        const ptrs = ptrElements.map((el) => this.parsePointer(el));\r\n\r\n        return ptrs;\r\n    }\r\n\r\n    private parsePointer(ptrElement: Element): PointerData {\r\n        const rdgElement = ptrElement.parentNode as Element;\r\n        if (!rdgElement || rdgElement.tagName !== 'rdg') {\r\n            throw new Error(`Parent of <ptr> is not <rdg>`);\r\n        }\r\n        const witAttr = rdgElement.attributes.getNamedItem('wit');\r\n        if (!witAttr) {\r\n            throw new Error('<rdg> element does not have a wit attribute');\r\n        }\r\n        const editionCode = witAttr.value.substr(2);  // with is #f1818, #fMS etc...\r\n        let edition: Edition;\r\n        try {\r\n            edition = FvStore.getEdition(editionCode);\r\n        } catch(err) {\r\n            throw new Error(`<rdg> has invalid witness ${witAttr.value}`);\r\n        }\r\n\r\n        const rdgGroupElement = rdgElement.parentNode as Element;\r\n        if(!rdgGroupElement || rdgGroupElement.tagName !== 'rdgGrp') {\r\n            throw new Error(`Parent of <rdg> element is not <rdgGrp>`);\r\n        }\r\n        const grpIdAttr = rdgGroupElement.attributes.getNamedItem('xml:id');\r\n        if (!grpIdAttr) {\r\n            throw new Error('<rdrGrp> has no xml:id');\r\n        }\r\n        const groupId = grpIdAttr.value;\r\n\r\n        const targetAttr = ptrElement.attributes.getNamedItem('target');\r\n        if (!targetAttr) {\r\n            throw new Error(`<ptr> element has not target attribute`);\r\n        }\r\n\r\n        const parts = targetAttr.value.split('#')\r\n        if (parts.length !== 2) {\r\n            throw new Error(`Target ${targetAttr.value} is not well formatted. Expected uri#xpath`);\r\n        }\r\n\r\n        return {\r\n            ptrElement,\r\n            edition,\r\n            groupId,\r\n            referencedUrl: parts[0],\r\n            referencedTarget: parts[1],\r\n        };\r\n    }\r\n\r\n    public getOtherGroups(ed: Edition) {\r\n        // Returns all the groups besides the one that holds this edition\r\n        return this.groups.filter((grp) => grp.editions.indexOf(ed) === -1);\r\n    }\r\n}\r\n\r\ninterface StringRange {\r\n    xpath: string,\r\n    start: number,\r\n    length: number,\r\n}\r\n\r\n\r\nexport class Spine {\r\n    public readonly chunkNumber: number;\r\n    private _apps: Apparatus[] | undefined;\r\n    private _xml: Document | undefined;\r\n    private _initialized = false;\r\n    private _initializationPromise?: Promise<void>;\r\n    private static mockElementCount = 0;\r\n    \r\n    constructor(chunk: number) {\r\n        this.chunkNumber = chunk\r\n    }\r\n\r\n    public initialize(): Promise<void> {\r\n        // Initialize may be called several times before the first initialization complete.\r\n        // We make sure initialization runs only once\r\n        if(this._initializationPromise) {\r\n            return this._initializationPromise;\r\n        }\r\n\r\n        this._initializationPromise = this.innerInitialize();\r\n        this._initializationPromise.then(() => {\r\n            this._initializationPromise = undefined;\r\n        })\r\n        return this._initializationPromise;\r\n    }\r\n\r\n    private async innerInitialize() {\r\n        if(this._initialized) {\r\n            return;\r\n        }\r\n\r\n        this._xml = await this.getXML();\r\n\r\n        await this.parseApps();\r\n        await this.fetchAllReferences();\r\n        await this.rewriteStringRanges();\r\n        await this.dereferencePointers();\r\n        this.addBackPointers();\r\n        this.buildGroupsInApps();\r\n        \r\n        this._initialized = true;\r\n    }\r\n\r\n    private async getXML() {\r\n        const chunkStr = this.chunkNumber < 10 ? `0${this.chunkNumber}` : `${this.chunkNumber}`;\r\n        const url = `https://raw.githubusercontent.com/PghFrankenstein/fv-data/master/standoff_Spine/spine_C${chunkStr}.xml`\r\n\r\n        const document = await FvStore.cache.getXML(url);\r\n        return document;\r\n    }\r\n\r\n    private async parseApps() {\r\n        if(!this._xml) {\r\n            throw new Error('parseApps called before getXML, which makes no sense')\r\n        }\r\n\r\n        const appElements = Array.from(this._xml.getElementsByTagName('app'));\r\n        const apps = appElements.map((app) => new Apparatus(app));\r\n        this._apps = apps;\r\n    }\r\n\r\n    public get apps(): Apparatus[] {\r\n        if (!this._apps) {\r\n            throw new Error(`Spine not initialized yet`);\r\n        }\r\n        return this._apps;\r\n    }\r\n\r\n    // Download all referenced XMLs concurrently (if they're not cached)\r\n    private async fetchAllReferences() {\r\n        let allUrls = [] as string[];\r\n\r\n        for(let app of this.apps) {\r\n            const urls = app.pointers.map((ptr) => ptr.referencedUrl);\r\n            allUrls = allUrls.concat(urls);\r\n        }\r\n\r\n        const unique = Array.from(new Set<string>(allUrls));\r\n        const promises = unique.map((url) => FvStore.cache.getXML(url));\r\n        await Promise.all(promises);  // Returns only once all URLs have been fetched\r\n    }\r\n\r\n    // Rewrite string ranges to ordinary pointers. \r\n    // This is done by adding tags in the target XML with their own ID surrounding the relevant text elements\r\n\r\n    private async rewriteStringRanges() {\r\n        const re = /^string-range\\((?<xpath>.+),(?<start>\\d+),(?<length>\\d+)\\)$/;\r\n        \r\n        for(let app of this.apps) {\r\n            const invalidPointers = new Set<PointerData>();\r\n            for(let ptr of app.pointers) {\r\n                const match = ptr.referencedTarget.match(re);\r\n                if (match) {\r\n                    const stringRange = {\r\n                        xpath: match.groups!.xpath,\r\n                        start: parseInt(match.groups!.start),\r\n                        length: parseInt(match.groups!.length),\r\n                    };\r\n                    try {\r\n                        await this.rewriteStringRange(ptr, stringRange);\r\n                    } catch(err) {\r\n                        invalidPointers.add(ptr);\r\n                    }\r\n                }\r\n            }\r\n\r\n            const validPointers = app.pointers.filter((ptr) => !invalidPointers.has(ptr));\r\n            app.pointers = validPointers;\r\n        }\r\n    }\r\n\r\n    private async rewriteStringRange(ptr: PointerData, range: StringRange) {\r\n        // For now - just get the xml:id of the target element and replace the pointer's target.\r\n        // Add an xml:id if none exists on the target element\r\n        const targetDoc = await FvStore.cache.getXML(ptr.referencedUrl);\r\n        const targetNodes = evaluateXPath(targetDoc, range.xpath);\r\n\r\n        if (targetNodes.length === 0) {\r\n            console.error(`string-range for xpath ${range.xpath} failed to return a node`);\r\n            throw Error('string-range returned no nodes');\r\n        }\r\n\r\n        if (targetNodes.length > 1) {\r\n            console.error(`string-range for xpath ${range.xpath} returned more than one node`);\r\n            throw Error('string-range returned more than one node');\r\n        }\r\n\r\n        const targetElement = targetNodes[0] as Element;\r\n        const idAttr = targetElement.attributes.getNamedItem('xml:id');\r\n        let xmlId = '';\r\n        if (idAttr) {\r\n            xmlId = idAttr.value;\r\n        } else {\r\n            xmlId = `mock-id-${Spine.mockElementCount}`;\r\n            Spine.mockElementCount += 1;\r\n\r\n            // Adding xml:id to an existing document doesn't work fully - XPath doesn't find it\r\n            // unless the document is completely reparsed. So we add our own mock-id attribute instead\r\n            targetElement.setAttribute('mock-id', xmlId);\r\n        }\r\n\r\n        // Update the Pointer\r\n        ptr.referencedTarget = xmlId;  // In memory\r\n        ptr.ptrElement.setAttribute('target', `${ptr.referencedUrl}#${xmlId}`);\r\n    }\r\n\r\n    private async dereferencePointers() {\r\n        for(let app of this.apps) {\r\n            const invalidPointers = new Set<PointerData>();\r\n\r\n            for(let ptr of app.pointers) {\r\n                const document = await FvStore.cache.getXML(ptr.referencedUrl);\r\n                try {\r\n                    const element = findElementByXmlId(document, ptr.referencedTarget);\r\n                    ptr.dereferenced = element;\r\n                } catch(err) {\r\n                    console.error(`Pointer ${ptr.ptrElement.outerHTML} is invalid`);\r\n                    invalidPointers.add(ptr);\r\n                }\r\n            }\r\n\r\n            const validPointers = app.pointers.filter((ptr) => !invalidPointers.has(ptr));\r\n            app.pointers = validPointers\r\n        }\r\n    }\r\n\r\n    private addBackPointers() {\r\n        // We will add the back pointers to all editions while we're at it\r\n        // Backpointers are an attribute - app-ref, which contains the id of the app element\r\n        for(let app of this.apps) {\r\n            for(let ptr of app.pointers) {\r\n                if (!ptr.dereferenced) {\r\n                    console.error('Non dereferenced pointed in addBackPointers - pointers should all be dereferenced by now');\r\n                    continue;\r\n                }\r\n                ptr.dereferenced!.setAttribute('app-ref', app.id);\r\n            }\r\n        }\r\n    }\r\n\r\n    private buildGroupsInApps() {\r\n        // Build the groups in all App objects\r\n        for(const app of this.apps) {\r\n            app.buildGroups();\r\n        }\r\n    }\r\n}\r\n","import XmlCache from \"./xml-cache\";\r\nimport { Edition, EditionWithBody, MSEdition } from \"./edition\";\r\nimport { Spine } from \"./spine\";\r\n\r\n/*\r\n * This class contains the application Store, which holds all the TEI data, as well as processed data.\r\n * We are not using a Redux store here to save time. In the future we might turn this into a Redux store.\r\n * In the mean time, we have a singleton store instance, which is passed to the root component of the application,\r\n * (although the singleton can just be accessed by any class)\r\n */\r\n\r\n class FvStoreClass {\r\n     public readonly cache: XmlCache;\r\n     public readonly editions: Edition[];\r\n     public readonly spines: Spine[];\r\n     public static instance = new FvStoreClass();\r\n\r\n     private constructor() {\r\n         this.cache = new XmlCache();\r\n         this.editions = [\r\n             new EditionWithBody('1818', '1818', [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]),\r\n             new EditionWithBody('1823', '1823', [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]),\r\n             new EditionWithBody('1831', '1831', [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]),\r\n             new EditionWithBody('Thomas', 'Thomas', [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]),\r\n             new MSEdition('MS', 'MS', [7, 8, 9, 10]),\r\n         ]\r\n\r\n         this.spines = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((i) => new Spine(i));\r\n     }\r\n\r\n     public getEdition(code: string): Edition {\r\n         const ed = this.editions.find((ed) => ed.code === code);\r\n\r\n         if (!ed) {\r\n             throw new Error(`Can't find edition ${code}`);\r\n         }\r\n         return ed;\r\n     }\r\n\r\n     public getSpine(chunk: number): Spine {\r\n         const spine = this.spines.find((sp) => sp.chunkNumber === chunk);\r\n\r\n         if(!spine) {\r\n             throw new Error(`Can't find spine for chunk ${chunk}`);\r\n         }\r\n         return spine;\r\n     }\r\n }\r\n\r\nconst FvStore = FvStoreClass.instance;\r\nexport default FvStore;  // Everybody can just access FvStore.property","import { Edition } from \"../../data/edition\";\r\nimport React from \"react\";\r\n\r\ninterface EditionDotProps {\r\n    edition: Edition;\r\n}\r\n\r\nclass EditionDot extends React.Component<EditionDotProps> {\r\n    render() {\r\n        const classes = `dot ed-${this.props.edition.code}`;\r\n\r\n        return <span className={classes}/>;\r\n    }\r\n}\r\n\r\nexport default EditionDot;","import React from 'react';\r\nimport Select from 'react-select';\r\nimport { Edition } from '../../data/edition';\r\nimport FvStore from '../../data/store';\r\nimport EditionDot from '../helpers/EditionDot';\r\n\r\nexport interface SelectOption {\r\n    value: string;\r\n    label: any;// HTMLSpanElement;\r\n}\r\n\r\ninterface EditionSelectorProps {\r\n    editions: Edition[],\r\n    edition: Edition,\r\n\r\n    onEditionSelected: (edition: Edition) => void;\r\n}\r\n\r\ninterface EditionSelectorState {\r\n    availableEditions: SelectOption[],\r\n    selectedEdition: SelectOption | undefined,\r\n}\r\n\r\nclass EditionSelector extends React.Component<EditionSelectorProps, EditionSelectorState> {\r\n\r\n    state = {\r\n        availableEditions: [] as SelectOption[],\r\n        selectedEdition: undefined as SelectOption | undefined,\r\n    }\r\n    \r\n    componentDidMount = () => {\r\n        const editions = FvStore.editions.map((ed, index) => ({ key: index, value: ed.code, label: <label><EditionDot edition={ ed }/>{ed.name}</label> } as SelectOption));\r\n\r\n        this.setState({ availableEditions: editions, });\r\n    }\r\n\r\n    componentDidUpdate(prevProps: EditionSelectorProps) {\r\n        if(prevProps.edition !== this.props.edition) {\r\n            const option = this.state.availableEditions.find((ed) => ed.value === this.props.edition.code);\r\n            if(option) {\r\n                this.setState( { selectedEdition: option });\r\n            }\r\n        }\r\n    }\r\n\r\n    editionChanged = (selectedOption: SelectOption) => {\r\n        const edition = FvStore.editions.find((ed) => ed.code === selectedOption.value);\r\n        if(!edition) {\r\n            console.warn(`Couldn't find edition for selection ${selectedOption.value}`);\r\n            return;\r\n        }\r\n\r\n        this.setState( { selectedEdition: selectedOption });\r\n        this.props.onEditionSelected(edition);\r\n    }\r\n\r\n\r\n    render() {\r\n        return (\r\n        <div>\r\n            <label>CHOOSE A VERSION</label>\r\n            <Select\r\n                className='select-style'\r\n                onChange={this.editionChanged}\r\n                options={this.state.availableEditions}\r\n                value={this.state.selectedEdition}\r\n            ></Select>\r\n        </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default EditionSelector;\r\n","import React from 'react';\r\nimport ReactHtmlParser from 'react-html-parser';\r\n\r\nexport interface TeiReactElementProps {\r\n   htmlTag?: string;\r\n   tag: string;\r\n   id?: string;\r\n   teiProps: any;\r\n   showText: boolean;\r\n   showVariations: boolean;\r\n}\r\n\r\nclass TeiReactElement extends React.Component<TeiReactElementProps> {\r\n     \r\n   render() {\r\n      let tag = '';\r\n      let closingTag = '';\r\n\r\n      if(this.props.htmlTag) {\r\n         tag = `<${this.props.htmlTag}>`;\r\n         closingTag = `</${this.props.htmlTag}>`;\r\n      }\r\n\r\n      return (\r\n         <div className={`tei-element tei-${this.props.tag}`} data-tei-tag={this.props.tag}>\r\n             {/* data-app-ref={appRef}> */}\r\n            {ReactHtmlParser(tag)}\r\n            {this.props.children}\r\n            {ReactHtmlParser(closingTag)}\r\n         </div>\r\n      );\r\n   }\r\n}\r\n\r\nexport default TeiReactElement;\r\n","import React from 'react';\r\n\r\ninterface TeiReactTextProps {\r\n    text: string;\r\n    showText: boolean;\r\n    showVariations: boolean;\r\n}\r\n\r\nclass TeiReactText extends React.Component<TeiReactTextProps> {\r\n\r\n    render() {\r\n        let classes = 'tei-cdata';\r\n        if (!this.props.showText) {\r\n            classes += ' no-text';\r\n        }\r\n\r\n        return (\r\n            <span className={classes}>\r\n                { this.props.text }      \r\n            </span>\r\n        );\r\n    }\r\n}\r\n\r\nexport default TeiReactText;\r\n","import React from 'react';\r\nimport { Apparatus } from '../../data/spine';\r\nimport { Edition } from '../../data/edition';\r\nimport EditionDot from '../helpers/EditionDot';\r\n\r\ninterface TeiAppWrapperProps {\r\n   showVariations: boolean;\r\n   showText: boolean;\r\n   edition?: Edition;\r\n   app: Apparatus;\r\n   onAppClick?: (app: Apparatus) => void,\r\n}\r\n\r\nclass TeiAppWrapper extends React.Component<TeiAppWrapperProps> {\r\n   onClick = () => {\r\n      if (this.props.showVariations && this.props.onAppClick) {\r\n         this.props.onAppClick(this.props.app);\r\n      }\r\n   }\r\n\r\n   render() {\r\n      if(!this.props.showVariations) {\r\n         return <div className='app-wrapper-hidden'>{ this.props.children }</div>;\r\n      }\r\n\r\n      const intensity = this.props.app.n || 1;\r\n      const level = (intensity < 5) ? 1 : (intensity < 25) ? 2 : 3;\r\n      const classes = `app-wrapper app-intensity-${level}`;\r\n\r\n      // Calculate the dot elements\r\n      const groups = this.props.app.getOtherGroups(this.props.edition!);\r\n      let dotElements: any[] = [];\r\n      let key = 0;\r\n      for(const group of groups) {\r\n         const groupDots = group.editions.map((ed) => <EditionDot edition={ ed } key={ed.code} />);\r\n         dotElements = dotElements.concat(groupDots);\r\n         dotElements.push(<span className='dot dot-break' key={key}/>);\r\n         key++;\r\n      }\r\n\r\n      let dotClasses = 'app-wrapper-dots';\r\n      if(!this.props.showText) {\r\n         dotClasses += ' no-text';\r\n      }\r\n\r\n      return (\r\n         <div className={classes} onClick={this.onClick}>\r\n            <div className={dotClasses}>\r\n               { dotElements }\r\n            </div>\r\n            { this.props.children }\r\n         </div>\r\n      );\r\n   }\r\n}\r\n\r\nexport default TeiAppWrapper;\r\n","/* This file contains a class that takes the TEI and converts it into a React tree */\r\n\r\nimport React, { ReactNode } from 'react';\r\nimport TeiReactElement from '../components/tei/TeiReactElement';\r\nimport TeiReactText from '../components/tei/TeiReactText';\r\nimport { Chunk, Edition } from '../data/edition';\r\nimport TeiAppWrapper from '../components/tei/TeiAppWrapper';\r\nimport { Apparatus } from '../data/spine';\r\n\r\nexport class TeiConverter {\r\n    private static index = 0;\r\n\r\n    constructor(private showVariations: boolean, private showText: boolean, private edition?: Edition, private chunk?: Chunk) {\r\n    }\r\n\r\n    private getHtmlTag(teiTag: string) {\r\n        if (teiTag === 'p') {\r\n            return 'p';\r\n        } else if (teiTag === 'head') {\r\n            return 'h3';\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    private buildProperties(node: Node): any {\r\n        const nodeAttributes = (node as any).attributes;\r\n        const valueProps: any = {};\r\n\r\n        for (var i = 0; i < nodeAttributes.length; i++) {\r\n            let name = nodeAttributes[i].nodeName;\r\n            if (name === 'xml:id') {\r\n                name = 'id';\r\n            }\r\n            valueProps[name] = nodeAttributes[i].nodeValue;\r\n        }\r\n\r\n        return valueProps;\r\n    }\r\n\r\n    public teiToReactElement(node: Node, onAppClick?: (app: Apparatus) => void): ReactNode {  // Returns a single React element\r\n        const reactChildren: ReactNode[] = [];\r\n        // create elements for all children\r\n        if (node.hasChildNodes()) {\r\n            for (let i = 0; i < node.childNodes.length; i++) {\r\n                const childNode = node.childNodes[i];\r\n                let childElement: ReactNode = undefined;\r\n                if (childNode.nodeType === 1) {\r\n                    childElement = this.teiToReactElement(childNode, onAppClick);\r\n                } else if (childNode.nodeType === 3) {\r\n                    let text = childNode.textContent || '';\r\n                    text = text.trim();\r\n                    if (text) {\r\n                        childElement = React.createElement(TeiReactText, {\r\n                            text: childNode.textContent || '',\r\n                            showText: this.showText,\r\n                            showVariations: this.showVariations,\r\n                            key: TeiConverter.index++,\r\n                        });\r\n                    }\r\n                } else {\r\n                    console.warn('Child node of unrecognizezd type: ', childNode);\r\n                }\r\n\r\n                if (childElement) {\r\n                    reactChildren.push(childElement);\r\n                }\r\n            }\r\n        }\r\n\r\n        // build properties\r\n        const teiProps = this.buildProperties(node);\r\n\r\n        // return create react element\r\n        var props: any = {\r\n            tag: node.nodeName,\r\n            key: TeiConverter.index++,\r\n            htmlTag: this.getHtmlTag(node.nodeName),\r\n            showText: this.showText,\r\n            showVariations: this.showVariations,\r\n            teiProps: teiProps,\r\n        };\r\n\r\n        let reactElement: ReactNode = React.createElement(TeiReactElement, props, reactChildren); // Pass children\r\n\r\n        if (this.chunk && this.showVariations && teiProps['app-ref']) {\r\n            const app = this.chunk.getApp(teiProps['app-ref']);\r\n\r\n            // We have an <app> to wrap around the element\r\n            reactElement = React.createElement(TeiAppWrapper, {\r\n                key: TeiConverter.index++,\r\n                showVariations: this.showVariations,\r\n                showText: this.showText,\r\n                edition: this.edition,\r\n                onAppClick,\r\n                app},\r\n            [reactElement])\r\n        }\r\n\r\n        return reactElement;\r\n    }\r\n}\r\n","import React, { ReactNode } from 'react';\r\nimport { TeiConverter } from '../../tei-processing/tei-converter';\r\nimport { Chunk, Edition } from '../../data/edition';\r\nimport { Apparatus } from '../../data/spine';\r\n\r\ninterface TeiRenderingProps {\r\n    chunk: Chunk;\r\n    showVariations: boolean;\r\n    showText: boolean;\r\n    edition: Edition;\r\n    onAppClick?: (app: Apparatus) => void;\r\n}\r\n\r\ninterface TeiRenderingState {\r\n    elements?: ReactNode[];\r\n}\r\n\r\nclass TeiRendering extends React.Component<TeiRenderingProps, TeiRenderingState> {\r\n    state = {\r\n        elements: undefined,\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.getTeiObjects();\r\n    }\r\n\r\n    componentDidUpdate(prevProps: TeiRenderingProps) {\r\n        if(!prevProps || \r\n            this.props.chunk !== prevProps.chunk || \r\n            this.props.edition !== prevProps.edition || \r\n            this.props.showText !== prevProps.showText ||\r\n            this.props.showVariations !== prevProps.showVariations) {\r\n            this.getTeiObjects(); // No matter which property has changed, we need to render everything again\r\n        }\r\n    }\r\n\r\n    getTeiObjects = () => {\r\n        const converter = new TeiConverter(this.props.showVariations, this.props.showText, this.props.edition, this.props.chunk);\r\n        const elements = this.props.chunk.mainRoots.map((root) => converter.teiToReactElement(root, this.props.onAppClick));\r\n\r\n        this.setState( { elements });\r\n    } \r\n\r\n    render() {\r\n        return (\r\n            <div className=\"tei-container\">\r\n                { this.state.elements }\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default TeiRendering;\r\n","import React from 'react';\r\nimport { Edition, Chunk } from '../../data/edition';\r\nimport Select from 'react-select';\r\nimport { SelectOption } from './EditionSelector';\r\nimport pre from '../../assets/pre.jpg';\r\nimport next from '../../assets/next.jpg';\r\n\r\ninterface PagingProps {\r\n    edition: Edition | undefined;\r\n    chunk: number;\r\n    onChunkSelected: (chunk: number) => void;\r\n}\r\n\r\ninterface PagingState {\r\n    chunkIndex: number,\r\n    selectedOption: SelectOption | undefined,\r\n    availableChunks: SelectOption[],\r\n    disablePrev: boolean,\r\n    disableNext: boolean,\r\n}\r\n\r\nclass Paging extends React.Component<PagingProps, PagingState> {\r\n\r\n    state = {\r\n        chunkIndex: this.props.chunk,\r\n        selectedOption: undefined as SelectOption | undefined,\r\n        availableChunks: [] as SelectOption[],\r\n        disablePrev: true,\r\n        disableNext: false,\r\n    }\r\n\r\n    componentDidUpdate(prevProps: PagingProps) {\r\n        if (this.props.edition !== prevProps.edition) {\r\n            let chunks = [] as SelectOption[];\r\n            if (this.props.edition) {\r\n                chunks = this.props.edition.chunks.map((c) => ({ value: c.toString(), label: c.toString() } as SelectOption));\r\n                const firstChunk = this.props.edition.chunks[0];\r\n                this.setState( { availableChunks: chunks, chunkIndex: 0, selectedOption: chunks[0] });\r\n                this.props.onChunkSelected(firstChunk);\r\n            }\r\n        }\r\n\r\n        if (this.props.chunk !== prevProps.chunk) {\r\n            const index = this.state.availableChunks.findIndex((opt) => opt.value === this.props.chunk.toString());\r\n            if (index !== -1) {\r\n                this.setState({ \r\n                    chunkIndex: index, \r\n                    selectedOption: this.state.availableChunks[index], \r\n                    disablePrev: index===0, \r\n                    disableNext: index===this.state.availableChunks.length - 1 \r\n                });\r\n            } else {\r\n                console.warn(`Can't set pager to non existing chunk ${this.props.chunk}`);\r\n                this.setState({ chunkIndex: 0, selectedOption: this.state.availableChunks[0], disablePrev: true, disableNext: this.state.availableChunks.length === 1 });\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n    onChunkChanged = (selectedOption: SelectOption) => {\r\n        const chunk = parseInt(selectedOption.value);\r\n        const index = this.state.availableChunks.findIndex((opt) => opt.value === chunk.toString());\r\n        this.setState({ chunkIndex: index, selectedOption });\r\n\r\n        this.props.onChunkSelected(chunk);\r\n    }\r\n\r\n    updateChunk = (delta: number) => {\r\n        this.setState( {disablePrev: false, disableNext: false} );\r\n        const chunk = this.state.chunkIndex + 1;\r\n        const newChunk = chunk + delta;\r\n        if (newChunk === 1) {\r\n            this.setState( {disablePrev: true} );\r\n        } else if (newChunk === this.state.availableChunks.length) {\r\n            this.setState( {disableNext: true })\r\n        }\r\n        if (this.props.edition!.chunks.indexOf(newChunk) === -1) {\r\n            return;\r\n        }\r\n        const newOption = this.state.availableChunks.find((opt) => opt.value === newChunk.toString());\r\n        if (!newOption) {\r\n            console.error(\"Can't locate new option!\")\r\n        }\r\n        this.setState({ chunkIndex: newChunk - 1, selectedOption: newOption });\r\n        this.props.onChunkSelected((newChunk));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                {this.props.edition ?\r\n                <div>\r\n                    <div className='in-line'>\r\n                        <label>CHOOSE A SECTION</label>\r\n                        <Select\r\n                            className='select-style'\r\n                            onChange={this.onChunkChanged}\r\n                            options={this.state.availableChunks}\r\n                            value={this.state.selectedOption}\r\n                        />\r\n                    </div>\r\n                    \r\n                    <div className='in-line paging-buttons'>\r\n                        <button onClick={() => this.updateChunk(-1)} className={this.state.disablePrev ? 'disable-button': ''}\r\n                            disabled={this.state.disablePrev}><img src={pre} alt={pre} /></button><label>Previous Section</label>\r\n                        <label className='margin-button'>Next Section</label><button className={this.state.disableNext ? 'disable-button': ''} onClick={() => this.updateChunk(1)}\r\n                            disabled={this.state.disableNext}><img src={next} alt={next} /></button>\r\n                    </div>\r\n                </div>\r\n                : ''}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Paging;\r\n","import React from 'react';\r\nimport FvStore from '../../data/store';\r\nimport { Edition } from '../../data/edition';\r\n\r\nimport variations from '../../images/intensity_legend.svg';\r\nimport EditionDot from '../helpers/EditionDot';\r\n\r\ninterface HeaderData {\r\n    edition: Edition | undefined;\r\n}\r\n\r\nclass Header extends React.Component<HeaderData> {\r\n\r\n    render() {\r\n        const editions = FvStore.editions.map((e, index) => \r\n            <label key={index} className='edition-label'><EditionDot edition={e} key={e.code}/>{e.name}</label>);\r\n        return (\r\n            <div>\r\n                <header className='viewer__cols'>\r\n                    <div id='viewer__legend-editions'>\r\n                        {editions}\r\n                    </div>\r\n                    <div id='viewer__title'>\r\n                        {this.props.edition ?\r\n                        <h2>{this.props.edition.name} Edition</h2>\r\n                        : <h2>Edition</h2>}\r\n                    </div>\r\n                    <div id='viewer__legend-variance'>\r\n                        <label>Amount of Variance</label>\r\n                        <img src={variations} alt={variations} />\r\n                    </div>\r\n                </header>\r\n\r\n                <hr className='line' />\r\n                <div className='viewer__cols'>\r\n                    <div>Marginalia</div>\r\n                    <div>Text</div>\r\n                    <div>Variations</div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Header;\r\n","import React from 'react';\r\n\r\ninterface OptionsSelectorProps {\r\n    showVariations: boolean,\r\n    showText: boolean,\r\n\r\n    onVariationChanged: (variation: boolean) => void;\r\n    onTextChanged: (text: boolean) => void;\r\n}\r\n\r\ninterface OptionsSelectorState {\r\n    showVariations: boolean,\r\n    showText: boolean,\r\n}\r\n\r\nclass OptionsSelector extends React.Component<OptionsSelectorProps, OptionsSelectorState> {\r\n\r\n    state = {\r\n        showVariations: true,\r\n        showText: true,\r\n    }\r\n    \r\n    componentDidUpdate(prevProps: OptionsSelectorProps) {\r\n        if (this.props.showVariations !== this.state.showVariations) {\r\n            this.setState( { showVariations: this.props.showVariations });\r\n        }\r\n\r\n        if(this.props.showText !== this.state.showText) {\r\n            this.setState( { showText: this.props.showText });\r\n        }\r\n        \r\n    }\r\n\r\n    onVariationChanged = () => {\r\n        const newShow = !this.state.showVariations;\r\n        this.setState( { showVariations: newShow });\r\n        this.props.onVariationChanged(newShow);\r\n    }\r\n    \r\n    onTextChanged = () => {\r\n        const newShowText = !this.state.showText;\r\n        this.setState( { showText: newShowText });\r\n        this.props.onTextChanged(newShowText);\r\n    }\r\n    \r\n    render() {\r\n        return (\r\n        <div>\r\n            <label className='options-label'>CHOOSE OPTIONS</label>\r\n            <label className='options-label'>\r\n                <input\r\n                    name=\"variation\"\r\n                    type=\"checkbox\"\r\n                    checked={this.state.showVariations}\r\n                    onChange={this.onVariationChanged} />\r\n                See Variants\r\n            </label>\r\n            \r\n            <label className='options-label'>\r\n                <input\r\n                    name=\"text\"\r\n                    type=\"checkbox\"\r\n                    checked={this.state.showText}\r\n                    onChange={this.onTextChanged} />\r\n                See Text\r\n            </label>\r\n        </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default OptionsSelector;\r\n","import { ReadingGroup } from \"../../data/spine\";\r\nimport React from \"react\";\r\nimport EditionDot from \"../helpers/EditionDot\";\r\nimport { TeiConverter } from \"../../tei-processing/tei-converter\";\r\n\r\ninterface ReadingGroupComponentProps {\r\n    group: ReadingGroup;\r\n}\r\n\r\n// Note: This class is called ReadingGroupComponent because ReadingGroup is already taken\r\nclass ReadingGroupComponent extends React.Component<ReadingGroupComponentProps> {\r\n    render() {\r\n        const editionNames = this.props.group.editions.map((ed) => ed.name);\r\n        const title = editionNames.join(', ')\r\n        const dots = this.props.group.editions.map((ed) => <EditionDot edition={ed} key={ed.code}/>);\r\n\r\n        const converter = new TeiConverter(false, true);\r\n        const content = converter.teiToReactElement(this.props.group.element);\r\n\r\n        return (\r\n            <div className='reading-group'>\r\n                <div className='reading-group-dots'>{ dots }</div>\r\n                <div className='reading-group-title'>{ title }</div>\r\n                <div className='reading-group-content'>\r\n                    { content }\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ReadingGroupComponent;","import { Apparatus } from \"../../data/spine\";\r\nimport React from \"react\";\r\nimport { Edition } from \"../../data/edition\";\r\nimport ReadingGroupComponent from \"./ReadingGroupComponent\";\r\n\r\ninterface VariationProps {\r\n    app: Apparatus;\r\n    edition: Edition;\r\n}\r\n\r\nclass Variation extends React.Component <VariationProps> {\r\n    render() {\r\n        const groups = this.props.app.groups.map((grp) => (\r\n            <ReadingGroupComponent group={grp} key={grp.groupId}/>\r\n        ))\r\n        return (\r\n            <div className=\"app-list\">\r\n                <hr className=\"app-list-to-divider\"/>\r\n                { groups }\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Variation;","import React from 'react';\r\nimport EditionSelector from '../PageLayout/EditionSelector';\r\nimport TeiRendering from '../tei/TeiContainer';\r\nimport FvStore from '../../data/store';\r\nimport { Edition, Chunk } from '../../data/edition';\r\nimport Paging from '../PageLayout/Paging';\r\nimport Header from '../PageLayout/Header';\r\nimport OptionsSelector from '../PageLayout/OptionsSelector';\r\nimport { Apparatus } from '../../data/spine';\r\nimport Variation from '../Variations/Variation';\r\n\r\ninterface ViewerProperties { }\r\n\r\ninterface ViewerState {\r\n    loading: boolean,\r\n    chunk?: Chunk,\r\n    chunkNumber: number,\r\n    edition?: Edition,\r\n    showVariations: boolean,\r\n    showText: boolean,\r\n    app: Apparatus | undefined,\r\n}\r\n\r\nclass Viewer extends React.Component <ViewerProperties, ViewerState> {\r\n    state = {\r\n        loading: false,\r\n        chunk: undefined as Chunk | undefined,\r\n        edition: undefined as Edition | undefined,\r\n        chunkNumber: 0,\r\n\r\n        showVariations: true,\r\n        showText: true,\r\n        app: undefined,\r\n    }\r\n\r\n    \r\n    onNewChunk = async (chunkNumber: number) => {\r\n        this.setState( {loading: true, chunk: undefined } );\r\n        \r\n        if (!this.state.edition) {\r\n            throw new Error(\"Cannot get chunk if there is no an edition\");\r\n        }\r\n        const chunk = await Chunk.load(this.state.edition, chunkNumber);\r\n        this.setState( {loading: false, chunk, chunkNumber: chunk.chunkNumber, app: undefined } );\r\n    }\r\n\r\n    onNewEdition = (edition: Edition) => {\r\n        this.setState( { edition, app: undefined } );\r\n    }\r\n    onVariation = (show: boolean) => {\r\n        this.setState( { showVariations: show } );\r\n    }\r\n    onText = (show: boolean) => {\r\n        this.setState( { showText: show } );\r\n    }\r\n\r\n    onAppClick = (app: Apparatus) => {\r\n        this.setState( {app} );\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <section id='viewer'>\r\n                <div id='viewer__controls'>\r\n                    <EditionSelector\r\n                    key={0}\r\n                    editions={FvStore.editions} \r\n                    edition={this.state.edition!}\r\n                    onEditionSelected={this.onNewEdition}\r\n                    />\r\n\r\n                    <Paging\r\n                    key={1}\r\n                    edition={this.state.edition} \r\n                    chunk={this.state.chunkNumber}\r\n                    onChunkSelected={this.onNewChunk} />\r\n\r\n                    <OptionsSelector \r\n                    showVariations={this.state.showVariations}\r\n                    showText={this.state.showText}\r\n                    onVariationChanged={this.onVariation}\r\n                    onTextChanged={this.onText}\r\n                    />\r\n                </div>\r\n                \r\n                <Header\r\n                edition={this.state.edition} />\r\n\r\n                <div id='viewer__contents' className='viewer__cols'>\r\n                    <aside id=\"viewer__marginalia\">\r\n                    </aside>\r\n                    { this.state.chunk && this.state.edition ? \r\n                    <TeiRendering\r\n                    chunk={this.state.chunk}\r\n                    edition={this.state.edition}\r\n                    showVariations={this.state.showVariations}\r\n                    showText={this.state.showText}\r\n                    onAppClick={this.onAppClick}/> : <div></div>}\r\n                    <aside id=\"viewer_variations\">\r\n                        { this.state.app ? <Variation app={this.state.app!} edition={this.state.edition!}/> : '' }\r\n                    </aside>\r\n                </div>\r\n\r\n                <hr className='line' />\r\n                <footer id=\"viewer_pagination_controls\">\r\n                    <div></div>\r\n                    \r\n                    <EditionSelector\r\n                    key={2}\r\n                    editions={FvStore.editions} \r\n                    edition={this.state.edition!}\r\n                    onEditionSelected={this.onNewEdition}\r\n                    />\r\n                    <Paging\r\n                    key={3}\r\n                    edition={this.state.edition} \r\n                    chunk={this.state.chunkNumber}\r\n                    onChunkSelected={this.onNewChunk} />\r\n                </footer>\r\n            </section>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Viewer;\r\n","import React from 'react';\r\nimport './App.css';\r\n// import Collator from './collator/Collator';\r\nimport Viewer from './components/Viewer/Viewer';\r\nimport './styles/sass/style.sass';\r\n\r\nclass App extends React.Component {\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className=\"App\">\r\n          <Viewer />\r\n        </div>\r\n      </div>);\r\n  }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}